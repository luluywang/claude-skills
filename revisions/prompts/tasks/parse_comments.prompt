# Parse Comments Task

**Purpose:** Extract individual referee comments from a single report file into structured JSON.

---

## Input

- **Report file:** Path to a .txt or .pdf referee report
- **Source label:** e.g., "Referee 1", "Editor"

## Task

Read the report and extract every distinct comment or question the referee raises. Each comment should be a self-contained unit that requires a separate response.

### Comment Boundaries

A new comment starts when:
- The referee uses explicit numbering (1., 2., (a), (b), etc.)
- A new topic begins after a paragraph break
- The referee transitions from one concern to another

A comment may span multiple paragraphs if they address the same point.

### Multi-Round Reports

Some reports contain the referee's assessment of prior responses. Look for patterns like:
- "No response:" or "Not addressed:"
- "The author has addressed this" / "This has been resolved"
- "I am satisfied with the response" / "I remain unconvinced"
- References to the previous round's response

Capture the prior status for each comment.

### Section/Figure/Table References

Extract any references the referee makes to specific parts of the manuscript:
- Page numbers ("on page 18")
- Section references ("Section III.B", "the model section")
- Figure references ("Figure 4a", "the main figure")
- Table references ("Table 2", "the summary statistics table")
- Equation references ("Equation 5", "the demand equation")

## Output Format

Return a JSON array:

```json
[
  {
    "id": "{source_prefix}_{number}",
    "source": "{Source label}",
    "number": 1,
    "text": "Full comment text exactly as written...",
    "prior_status": "No response|Addressed|Partially addressed|Not applicable",
    "references": {
      "pages": [18],
      "figures": ["4a"],
      "tables": ["2"],
      "sections": ["III.B"],
      "equations": ["5"]
    }
  }
]
```

### ID Convention

- Editor comments: `ed_1`, `ed_2`, ...
- Referee 1: `ref1_1`, `ref1_2`, ...
- Referee 2: `ref2_1`, `ref2_2`, ...

### Source Prefix Mapping

| Source Label | Prefix |
|---|---|
| Editor | ed |
| Referee 1 | ref1 |
| Referee 2 | ref2 |
| Referee 3 | ref3 |
| Referee 4 | ref4 |

## Rules

1. **Preserve exact text.** Do not paraphrase or summarize the comment — copy it verbatim.
2. **Split compound comments.** If a referee raises two distinct issues in one numbered point (e.g., "(a) fix the typo on page 5" and "(b) clarify the identification strategy"), split them into separate entries with sub-IDs (e.g., `ref1_3a`, `ref1_3b`).
3. **Include preamble comments.** If the referee has general remarks before numbered comments, extract those as comment #0 or #1 with a note that it's a general remark.
4. **Handle nested structure.** Editor letters often contain sub-points (a), (b), (c) under a main point. Preserve the full hierarchical context — include the parent text in each sub-comment so each entry is self-contained.
5. **Default prior_status.** If there's no indication of prior round status, set to "Not applicable".

## Write Output

Write the JSON array to `current/comments_{source_prefix}.json` (e.g., `current/comments_ref1.json`).

Return **only** a brief summary — the orchestrator will read the file for details:

```json
{
  "source": "{source_label}",
  "file": "current/comments_{prefix}.json",
  "count": N
}
```

Do NOT return the full JSON array inline. The orchestrator reads the files to merge them.
