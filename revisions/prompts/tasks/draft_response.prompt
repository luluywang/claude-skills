# Draft Response Task

**Purpose:** Draft a complete response to a single referee comment in the user's academic voice and style.

---

## Input

- **Comment:** Full comment text, type, difficulty, priority
- **Cross-refs:** Related comments from other referees (for consistency)
- **Cluster:** Thematic cluster this comment belongs to (if any)
- **Manuscript path:** For reading relevant sections
- **Prior response path:** For style extraction (if available)
- **Style conventions:** From `revisions/prompts/components/response_patterns.prompt`

## Task

Draft a response that:
1. Addresses the referee's concern directly
2. References specific manuscript content (sections, tables, figures)
3. Matches the user's established voice and style
4. Is ready for user review and editing

### Step 1: Read Relevant Manuscript Sections

Based on the comment's `references` field and content, read the relevant parts of the manuscript:
- Sections mentioned by the referee
- Tables/figures referenced
- Related methodology or results sections

### Step 2: Draft the Response

Follow the style conventions from `response_patterns.prompt`:

**Opening:** Lead with thanks/acknowledgment appropriate to the comment type:
- Substantive: "Thank you for this suggestion." / "This is an important point."
- Clarification: "Thank you for flagging this." / "I appreciate the opportunity to clarify."
- Minor: "Thank you, I have corrected this."

**Body:** Address the substance:
- Enumerate specific changes with `\begin{enumerate}` when multiple actions taken
- Reference sections/tables/figures via `\ref{label}` — find actual labels in the manuscript
- Cite literature via `\textcite{key}` or `\parencite{key}` — find actual citation keys
- For substantive comments: explain both what changed and why
- For clarification: quote or paraphrase the relevant manuscript text

**Cross-referencing:** When this comment relates to others:
- "This also addresses the related concern raised by Referee N (Comment M)."
- "I discuss this further in my response to the Editor's comment (a)."

**Length scaling:** Match response length to importance:
- Minor (typos, formatting): 1-2 sentences
- Clarification: 1 paragraph
- Standard substantive: 2-3 paragraphs with enumerate
- Hard substantive: Multi-paragraph with detailed evidence

### Step 3: Flag Uncertainties

Mark items needing user action:
- `[TODO: Verify this section reference]` — when you can't find the exact label
- `[TODO: Add specific results from new analysis]` — when response promises results you can't verify
- `[TODO: User to decide whether to include this robustness check]` — for escalate-level decisions
- `[TODO: Check citation key]` — when you're unsure about a bibliographic reference

## Output Format

Write to `current/responses/{comment_id}.md`:

```markdown
# Response: {comment_id}
## Source: {source} Comment {number}
## Type: {type} | Difficulty: {difficulty} | Priority: {priority}

### Original Comment
{full comment text}

### Draft Response
{response text with LaTeX formatting}

### Cross-References
- Related to: {list of cross-ref IDs}
- Cluster: {cluster name}

### TODOs
- [ ] {any TODO items}

### Manuscript References Used
- Section \ref{...}: {brief description of what was found}
- Table \ref{...}: {brief description}
```

## Rules

1. **Never fabricate manuscript content.** If you can't find what the response claims, flag with [TODO].
2. **Use the user's voice.** First person singular ("I have..."), formal but not stiff.
3. **Be specific.** Don't say "I have revised the section" — say "I have revised Section \ref{subsec:model-assumptions} to clarify..."
4. **Acknowledge legitimate concerns.** Don't be defensive. If the referee is right, say so.
5. **Don't over-promise.** If the user might not want to do the work, flag as [TODO] rather than committing.
6. **LaTeX formatting.** Use LaTeX commands in the draft — these will be compiled directly.
7. **Consistent cross-referencing.** When two referees raise the same issue, the responses should reference each other, not repeat the same argument verbatim.

## Return

Return: `{status: "complete"|"flagged", todo_count: N}`

- `complete` if response drafted with no critical TODOs
- `flagged` if response has TODOs that may block compilation
