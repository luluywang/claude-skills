{
  "project": "Credit Constraint Implementation",
  "created": "2026-01-02T00:00:00Z",
  "tasks": [
    {
      "id": 1,
      "task": "Modify credit_access_probability() to use logit(constraint_intercept + constraint_slope * centered_log_income)",
      "type": "code",
      "depends_on": [],
      "status": "complete",
      "notes": "Function signature changed, formula updated to logit(intercept + slope*income). Verified: intercept=0,slope=0 -> 0.5; intercept=10,slope=0 -> ~1.0. Call sites identified in model_functions.jl (line 1967) and model_unit_tests.jl"
    },
    {
      "id": 2,
      "task": "Update ConsPref struct: replace credit_constraint_k with constraint_intercept and constraint_slope",
      "type": "code",
      "depends_on": [1],
      "status": "complete",
      "notes": "Struct updated: type parameters changed from {S1,...,S10} to {S1,...,S11}. Removed credit_constraint_k::S10, added constraint_intercept::S10 and constraint_slope::S11. Docstring updated to document both new parameters with explanations of their roles. Syntax verified."
    },
    {
      "id": 3,
      "task": "Update ConsPref constructor with backward-compatible defaults",
      "type": "code",
      "depends_on": [2],
      "status": "complete",
      "notes": "Created two constructors: (1) 9-argument backward-compatible constructor defaults constraint_intercept=10.0, constraint_slope=0.0 (no constraint, ~100% access); (2) 11-argument explicit constructor accepts all parameters. Verified: 9-arg constructor produces ~99.995% access at median; 11-arg with intercept=0.847, slope=1.0 produces ~70% access. Both compile successfully."
    },
    {
      "id": 4,
      "task": "Update parameter vector handling (add both new params, remove old)",
      "type": "code",
      "depends_on": [2, 3],
      "status": "complete",
      "notes": "Updated parameter vector handling in model_functions.jl and model_unit_tests.jl. Changes: (1) Line 4516: expected_length now adds 2 params when credit_constraint_enabled; (2) Lines 4559-4567: extract both constraint_intercept and constraint_slope from vector; (3) Lines 4580-4581: pass both params to ConsPref constructor; (4) Line 4751: lower bounds set to [-5.0, 0.0]; (5) Line 4786: upper bounds set to [15.0, 5.0]; (6) Line 4821: initial values set to [0.847, 1.0]; (7) Line 1955: updated constraint active check; (8) Line 1977: updated credit_access_probability call; (9) Line 3841: updated Allocation struct type params; (10) Lines 3846-3849: updated build_new_cons_pref_intercept to use new params; (11) model_unit_tests.jl: updated test functions to use new parameters. Verified: parameter vectors build correctly, unpacking works, values roundtrip correctly."
    },
    {
      "id": 5,
      "task": "Update parameter unpacking in all model function call sites",
      "type": "code",
      "depends_on": [2, 3, 4],
      "status": "complete",
      "notes": "Verified all ConsPref construction sites and credit_access_probability calls use correct signatures. Found: (1) All ConsPref calls use either 9-arg backward-compatible constructor (defaults to 10.0, 0.0) or 11-arg explicit constructor; (2) Single credit_access_probability call in model_functions.jl:1977 correctly passes (centered_log_income, cons_pref.constraint_intercept, cons_pref.constraint_slope); (3) All test calls in model_unit_tests.jl use correct 3-parameter signature. Compilation test successful: model_functions.jl compiles without errors. Parameter unpacking test successful: build_init→build_param_from_vector roundtrip correctly extracts constraint_intercept=0.847 and constraint_slope=1.0."
    },
    {
      "id": 6,
      "task": "Remove CREDIT_CONSTRAINT_MEDIAN_ACCESS constant from settings.jl",
      "type": "code",
      "depends_on": [1],
      "status": "complete",
      "notes": "Constant removed from settings.jl (line 61). Updated comment to reflect new logit formula. Obsolete test function test_credit_access_probability() and testset 13.1 commented out in model_unit_tests.jl. Verified no active code references remain. Both settings.jl and model_functions.jl compile successfully."
    },
    {
      "id": 7,
      "task": "Unit test: Basic functional form verification (logit formula, parameter effects)",
      "type": "test",
      "depends_on": [1, 2, 3],
      "status": "complete",
      "notes": "Test function test_credit_access_probability_new() added at line 5659. All 7 test groups pass: basic logit formula, intercept effects, slope effects, zero slope flatness, large negative intercept, probability bounds [0,1], parameter sign effects. Testset 13.1 created. Fixed Allocation struct type parameters (S10, S11 added)."
    },
    {
      "id": 8,
      "task": "Unit test: Income monotonicity (positive slope → increasing access)",
      "type": "test",
      "depends_on": [7],
      "status": "complete",
      "notes": "Test function test_credit_access_monotonicity() added to model_unit_tests.jl. Tests: (1) Positive slope → strict monotonic increase across income range [-3,+3] (60 steps, all differences positive); (2) Zero slope → flat probability (all values identical); (3) Negative slope → strict monotonic decrease (60 steps, all differences negative); (4) Multiple slope values (0.5, 1.0, 1.5, 2.0) all preserve monotonicity; (5) Smoothness verification (step size ratio 5.3 < 10.0). All 308 assertions pass. Testset 13.1b added. Income gradient at slope=1.0: 90.51pp increase from income=-3 to +3 (0.0474 to 0.9526)."
    },
    {
      "id": 9,
      "task": "Unit test: Second-choice logit structure with constraints (volatility → same-type substitution)",
      "type": "test",
      "depends_on": [1, 2, 3, 4, 5],
      "status": "complete",
      "notes": "Test function test_second_choice_with_constraints() added to model_unit_tests.jl. Test creates 4-card scenario (2 debit, 2 credit) with constraints active (intercept=0.847, slope=1.0). Compares low volatility (char_vol[2]=0.5) vs high volatility (char_vol[2]=2.0). Results: Low vol: debit→debit 23.67%, credit→credit 36.28%, overall 30.66%. High vol: debit→debit 27.86%, credit→credit 46.20%, overall 38.07%. Change: +4.18pp debit, +9.92pp credit, +7.41pp overall. All 4 assertions pass: higher volatility increases same-type substitution for both debit and credit, overall increase >1pp. Testset 13.5 created. Logit property preserved with credit constraints active."
    },
    {
      "id": 10,
      "task": "Unit test: Market share constraint effect (5-15% reduction)",
      "type": "test",
      "depends_on": [1, 2, 3, 4, 5],
      "status": "pending",
      "notes": ""
    },
    {
      "id": 11,
      "task": "Unit test: Income gradient magnitude (10-30 pp increase from 25th to 75th percentile)",
      "type": "test",
      "depends_on": [7, 8],
      "status": "complete",
      "notes": "Test function test_income_gradient_magnitude() added to model_unit_tests.jl. All 26 assertions pass. Key results: gradient magnitude 19.55pp (within 10-30pp target), median access 70%, smoothness ratio 1.422 < 2.0. Testset 13.1c created."
    },
    {
      "id": 12,
      "task": "Parameter initialization in estimation scripts (equalize intercepts, zero income gradient)",
      "type": "code",
      "depends_on": [4, 5],
      "status": "pending",
      "notes": ""
    },
    {
      "id": 13,
      "task": "Run baseline estimation with CREDIT_CONSTRAINT=true, verify residuals < 1e-6",
      "type": "test",
      "depends_on": [12],
      "status": "pending",
      "notes": ""
    },
    {
      "id": 14,
      "task": "Run solve_model_foc.jl with constraints, compare equilibria",
      "type": "test",
      "depends_on": [13],
      "status": "pending",
      "notes": ""
    }
  ]
}
